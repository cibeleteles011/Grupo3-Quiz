<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jogador | Quiz</title>
  <link rel="stylesheet" href="/styles.css" />
  <script>
    (function(){
      try {
        var params = new URLSearchParams(window.location.search);
        var server = (params.get('server') || '').replace(/\/$/, '');
        if (server && server !== window.location.origin) {
          // Redireciona para o mesmo caminho no domínio do Host
          var qs = window.location.search;
          // Garante que ?server esteja presente e correto
          var base = server + window.location.pathname + qs;
          window.location.replace(base);
        }
      } catch(_) {}
    })();
  </script>
</head>
<body>
  <div class="container">
    <h1>Jogador</h1>

    <section id="join">
      <label>PIN da sala</label>
      <input id="pin" placeholder="Ex: 123456" maxlength="6" inputmode="numeric" pattern="\\d{6}" />
      <label>Seu nome</label>
      <input id="name" placeholder="Ex: Ana" />
      <label>Escolha um avatar</label>
      <div id="avatar-grid" class="avatar-grid"></div>
      <label>Cor do avatar</label>
      <input id="avatar-color" type="color" value="#ffffff" />
      <div class="actions">
        <button id="join-btn" class="btn">Entrar</button>
      </div>
      <div id="error" class="error hidden"></div>
    </section>

    <section id="waiting" class="hidden">
      <h2>Aguardando início...</h2>
      <div id="room-pin"></div>
    </section>

    <section id="game" class="hidden">
      <div class="question-header">
        <div>Questão <span id="q-index"></span>/<span id="q-total"></span></div>
        <div id="timer"></div>
      </div>
      <h2 id="q-text"></h2>
      <div id="options" class="options"></div>
      <div id="feedback" class="muted"></div>
    </section>

    <section id="end" class="hidden">
      <h2>Fim de jogo</h2>
      <ol id="leaderboard" class="leaderboard"></ol>
      <div id="podium-player" class="podium"></div>
    </section>
  </div>

  <!-- Áudios para feedback -->
  <audio id="sfx-click" crossorigin="anonymous" src="https://cdn.pixabay.com/download/audio/2022/03/09/audio_7c3e1c9f87.mp3?filename=click-124467.mp3"></audio>
  <audio id="sfx-reveal" crossorigin="anonymous" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_08a05559c8.mp3?filename=success-1-6297.mp3"></audio>

  <script>
    (function(){
      try {
        var params = new URLSearchParams(window.location.search);
        var server = (params.get('server') || window.location.origin).replace(/\/$/, '');
        var s = document.createElement('script');
        s.src = server + '/socket.io/socket.io.js';
        s.onload = function(){
          var app = document.createElement('script');
          app.src = '/js/player.js';
          document.body.appendChild(app);
        };
        s.onerror = function(){
          var cdn = document.createElement('script');
          cdn.src = 'https://cdn.socket.io/4.8.1/socket.io.min.js';
          cdn.integrity = 'sha384-Mh7mZHEU1p1rZl8qCY9LjzqB4Zb1pDqV0pW1qgMvH5nqCkqvzB3q8m6l+z2B+7lN';
          cdn.crossOrigin = 'anonymous';
          cdn.onload = function(){
            var app = document.createElement('script');
            app.src = '/js/player.js';
            document.body.appendChild(app);
          };
          document.body.appendChild(cdn);
        };
        document.body.appendChild(s);
      } catch(_) {
        var fallback = document.createElement('script');
        fallback.src = '/js/player.js';
        document.body.appendChild(fallback);
      }
    })();
  </script>
</body>
</html>
